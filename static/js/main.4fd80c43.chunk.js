(this.webpackJsonpwebrtcdemo=this.webpackJsonpwebrtcdemo||[]).push([[0],{43:function(e,t,n){},44:function(e,t,n){},52:function(e,t){},53:function(e,t){},54:function(e,t){},57:function(e,t,n){"use strict";n.r(t);var a=n(23),c=n.n(a),r=n(38),o=n.n(r),s=(n(43),n(44),n(28)),i=n(1),d=n.n(i),u=n(5),l=n(2),f=n(4),p=n(8),h=n(9),v=(n(58),n(18)),b=n(13),j=function(e){Object(p.a)(n,e);var t=Object(h.a)(n);function n(e){var a;return Object(l.a)(this,n),(a=t.call(this,e)).canvasRef=c.a.createRef(),a.state={input:"",canvas:[]},a}return Object(f.a)(n,[{key:"createCanvas",value:function(){console.log("Create Canvas"),this.setState({canvas:Object(b.jsx)("canvas",{id:"canvas",width:"640",height:"480",ref:this.canvasRef})})}},{key:"componentDidMount",value:function(){this.createCanvas()}},{key:"updateInputValue",value:function(e){this.setState({input:e.target.value})}},{key:"render",value:function(){var e=this,t=s.a.firestore(),n=new RTCPeerConnection({iceServers:[{urls:["stun:stun1.l.google.com:19302","stun:stun2.l.google.com:19302"]}],iceCandidatePoolSize:10}),a=null,c=null;Promise.all([v.d.tinyFaceDetector.loadFromUri("/models"),v.d.faceLandmark68Net.loadFromUri("/models"),v.d.faceRecognitionNet.loadFromUri("/models"),v.d.faceExpressionNet.loadFromUri("/models"),v.d.ageGenderNet.loadFromUri("/models")]).then(console.log("Loaded faceapi"));var r=function(){var t=Object(u.a)(d.a.mark((function t(){var r;return d.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,navigator.mediaDevices.getUserMedia({video:!0,audio:!1},(function(e){console.log(e)}));case 2:a=t.sent,c=new MediaStream,a.getTracks().forEach((function(e){n.addTrack(e,a)})),n.ontrack=function(e){e.streams[0].getTracks().forEach((function(e){c.addTrack(e)}))},e.webcamSrc.srcObject=a,e.remoteSrc.srcObject=c,r={width:640,height:480},setInterval(Object(u.a)(d.a.mark((function t(){var n,a;return d.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,v.b(e.webcamSrc,new v.a).withFaceLandmarks().withFaceExpressions().withAgeAndGender();case 2:n=t.sent,a=v.e(n,r),e.canvasRef.current.getContext("2d").clearRect(0,0,640,480),v.c.drawDetections(e.canvasRef.current,a),v.c.drawFaceLandmarks(e.canvasRef.current,a),v.c.drawFaceExpressions(e.canvasRef.current,a),a.forEach((function(t){var n=t.detection.box;new v.c.DrawBox(n,{label:Math.round(t.age)+" year old "+t.gender}).draw(e.canvasRef.current)})),0!==n.length?console.log(n):console.log("No face detected");case 10:case"end":return t.stop()}}),t)}))),150);case 10:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),o=function(){var a=Object(u.a)(d.a.mark((function a(){var c,r,o,s,i;return d.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return c=t.collection("calls").doc(),r=c.collection("offerCandidates"),o=c.collection("answerCandidates"),e.setState({input:c.id}),n.onicecandidate=function(e){e.candidate&&r.add(e.candidate.toJSON())},a.next=7,n.createOffer();case 7:return s=a.sent,a.next=10,n.setLocalDescription(s);case 10:return i={sdp:s.sdp,type:s.type},a.next=13,c.set({offer:i});case 13:c.onSnapshot((function(e){var t=e.data();if(!n.currentRemoteDescription&&(null===t||void 0===t?void 0:t.answer)){var a=new RTCSessionDescription(t.answer);n.setRemoteDescription(a)}})),o.onSnapshot((function(e){e.docChanges().forEach((function(e){if("added"===e.type){var t=new RTCIceCandidate(e.doc.data());n.addIceCandidate(t)}}))}));case 15:case"end":return a.stop()}}),a)})));return function(){return a.apply(this,arguments)}}(),i=function(){var a=Object(u.a)(d.a.mark((function a(){var c,r,o,s,i,u,l,f;return d.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return c=e.state.input,r=t.collection("calls").doc(c),o=r.collection("answerCandidates"),s=r.collection("offerCandidates"),n.onicecandidate=function(e){e.candidate&&o.add(e.candidate.toJSON())},a.next=7,r.get();case 7:return i=a.sent.data(),u=i.offer,a.next=11,n.setRemoteDescription(new RTCSessionDescription(u));case 11:return a.next=13,n.createAnswer();case 13:return l=a.sent,a.next=16,n.setLocalDescription(l);case 16:return f={type:l.type,sdp:l.sdp},a.next=19,r.update({answer:f});case 19:s.onSnapshot((function(e){e.docChanges().forEach((function(e){if(console.log(e.doc.data()),"added"===e.type){var t=e.doc.data();n.addIceCandidate(new RTCIceCandidate(t))}}))}));case 20:case"end":return a.stop()}}),a)})));return function(){return a.apply(this,arguments)}}();return Object(b.jsxs)("div",{children:[Object(b.jsx)("h1",{children:"Video Section"}),Object(b.jsx)("h1",{children:"Web RTC Demo"}),Object(b.jsxs)("span",{children:[Object(b.jsx)("h3",{children:"Local"}),this.state.canvas,Object(b.jsx)("video",{width:"640",height:"480",ref:function(t){e.webcamSrc=t},autoPlay:!0,playsInline:!0})]}),Object(b.jsxs)("span",{children:[Object(b.jsx)("h3",{children:"Remote"}),Object(b.jsx)("video",{ref:function(t){e.remoteSrc=t},autoPlay:!0,playsInline:!0})]}),Object(b.jsx)("button",{onClick:r,children:"Start webcam"}),Object(b.jsx)("h2",{children:"Create new call"}),Object(b.jsx)("button",{onClick:o,children:"Create Call (offer)"}),Object(b.jsx)("h2",{children:"Join a Call"}),Object(b.jsx)("input",{value:this.state.input,onChange:function(t){return e.updateInputValue(t)}}),Object(b.jsx)("button",{onClick:i,children:"Answer"}),Object(b.jsx)("button",{children:"Hangup"})]})}}]),n}(a.Component);var m=function(){return s.a.apps.length||s.a.initializeApp({apiKey:"AIzaSyCn_oUCgU-s21Nxe1OuOSrDDhsxROIkewc",authDomain:"webrtcdemo-d01e1.firebaseapp.com",projectId:"webrtcdemo-d01e1",storageBucket:"webrtcdemo-d01e1.appspot.com",messagingSenderId:"327532271316",appId:"1:327532271316:web:cca5d6b076578764f94d41",measurementId:"G-K3SR1DN4Z1"}),Object(b.jsx)("div",{className:"App",children:Object(b.jsx)(j,{})})},w=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,59)).then((function(t){var n=t.getCLS,a=t.getFID,c=t.getFCP,r=t.getLCP,o=t.getTTFB;n(e),a(e),c(e),r(e),o(e)}))};o.a.render(Object(b.jsx)(c.a.StrictMode,{children:Object(b.jsx)(m,{})}),document.getElementById("root")),w()}},[[57,1,2]]]);
//# sourceMappingURL=main.4fd80c43.chunk.js.map